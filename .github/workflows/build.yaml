name: PullRequest into Dev branch
on:
    # Triggers the workflow on push events but only for the "dev" branch.
    pull_request:
        branches: ['dev']
        types: [opened, reopened]

concurrency:
    group: ${{ github.ref }}
    cancel-in-progress: true

jobs:
    get-ado-token:
        uses: OutSystems/rd.github-reusable-workflows/.github/workflows/az-vault-get-key@CommitHash #v?.?.?
        with:
            key-name: o11odc-github-ado-token-prd

    get-sonar-token:
        uses: OutSystems/rd.github-reusable-workflows/.github/workflows/az-vault-get-key@CommitHash #v?.?.?
        with:
            key-name: o11odc-github-sonarcloud-token-prd

    build:
        needs: [get-ado-token, get-sonar-token]
        uses: OutSystems/rd.github-reusable-workflows/.github/workflows/ts-build-project@CommitHash #v?.?.?
        with:
            github-ref: ${{ github.ref }}
            run-jest-tests: false
        secrets:
            az-devops-token: ${{ needs.get-ado-token.outputs.az-keyvault-value }}
            sonarcloud-token: ${{ needs.get-sonar-token.outputs.az-keyvault-value }}
